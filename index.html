<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postempo | Lightning Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gifshot@0.4.5/build/gifshot.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;700&family=Syne:wght@800&family=Caveat:wght@700&family=Playfair+Display:wght@900&family=Bungee&family=JetBrains+Mono:wght@800&family=Unbounded:wght@900&family=Bodoni+Moda:ital@1&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Space Grotesk', sans-serif; background-color: #050505; color: #fff; overflow-x: hidden; }
        .syne { font-family: 'Syne', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        .card-container { perspective: 1200px; width: 100%; max-width: 400px; height: 260px; margin: auto; }
        .card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); transform-style: preserve-3d; }
        .flipped { transform: rotateY(180deg); }
        
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 28px; padding: 30px; display: flex; overflow: hidden; }
        .card-back { transform: rotateY(180deg); background: #ffffff; color: #000; align-items: center; justify-content: center; text-align: center; }

        /* VIBES */
        .vibe-noir { background: #111; color: white; }
        .vibe-acid { background: #DFFF00; color: #000; }
        .vibe-vapor { background: linear-gradient(45deg, #ff71ce, #01cdfe); color: #fff; }
        .vibe-blood { background: #660000; color: #ff4d4d; }
        .vibe-deep { background: #001f3f; color: #7fdbff; }
        .vibe-ghost { background: #f0f0f0; color: #111; }
        .vibe-lava { background: linear-gradient(135deg, #ff4e50, #f9d423); color: #fff; }
        .vibe-neon { background: #000; color: #39ff14; border: 2px solid #39ff14; }
        .vibe-slate { background: #2c3e50; color: #bdc3c7; }

        /* POSITIONS */
        .pos-center { align-items: center; justify-content: center; text-align: center; }
        .pos-top { align-items: flex-start; justify-content: center; text-align: center; }
        .pos-bottom { align-items: flex-end; justify-content: center; text-align: center; }
        .pos-left { align-items: center; justify-content: flex-start; text-align: left; }
        .pos-right { align-items: center; justify-content: flex-end; text-align: right; }

        /* FONTS */
        .font-modern { font-family: 'Syne', sans-serif; }
        .font-retro { font-family: 'Bungee', cursive; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-fancy { font-family: 'Bodoni Moda', serif; font-style: italic; }
        .font-boldest { font-family: 'Unbounded', sans-serif; }

        .handwritten { font-family: 'Caveat', cursive; font-size: 1.8rem; }
        
        /* EXPORT MODAL */
        #loader { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; flex-direction: column; align-items: center; justify-content: center; }
        .btn-opt { @apply p-2 border border-white/10 rounded-lg text-[8px] hover:bg-white/20 transition-all uppercase font-bold; }
    </style>
</head>
<body class="min-h-screen">

    <div id="loader">
        <button onclick="cancelExport()" class="absolute top-10 right-10 text-white hover:text-red-500 transition">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
        <div class="w-12 h-12 border-4 border-[#DFFF00] border-t-transparent rounded-full animate-spin mb-6"></div>
        <p class="syne text-xs tracking-widest uppercase text-white">Rendering High-Speed Vibe...</p>
        <p class="text-white/40 text-[10px] mt-2">Click X to Cancel</p>
    </div>

    <nav class="flex justify-between items-center p-4 glass sticky top-0 z-50">
        <h1 class="syne text-lg font-800 italic">POSTEMPO<span class="text-[#DFFF00]">.</span></h1>
        <div class="flex gap-2">
            <button onclick="shareLink()" class="bg-blue-600 px-4 py-2 rounded-full text-[10px] font-bold">SHARE</button>
            <button onclick="exportPNG()" class="bg-white text-black px-4 py-2 rounded-full text-[10px] font-bold">PNG</button>
            <button onclick="exportGIF()" class="bg-[#DFFF00] text-black px-4 py-2 rounded-full text-[10px] font-bold">GIF</button>
        </div>
    </nav>

    <main class="grid lg:grid-cols-2">
        <section class="p-6 space-y-6 glass overflow-y-auto max-h-[calc(100vh-80px)]">
            <div class="space-y-4">
                <input id="fIn" type="text" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl outline-none" placeholder="Front Text">
                <textarea id="bIn" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl h-24 outline-none" placeholder="Back Secret Message"></textarea>
            </div>

            <div class="grid grid-cols-5 gap-1">
                <p class="col-span-5 text-[9px] text-gray-500 font-bold mb-1 uppercase">Position</p>
                <button onclick="setPos('top')" class="btn-opt">Top</button>
                <button onclick="setPos('bottom')" class="btn-opt">Bot</button>
                <button onclick="setPos('left')" class="btn-opt">Left</button>
                <button onclick="setPos('right')" class="btn-opt">Right</button>
                <button onclick="setPos('center')" class="btn-opt">Mid</button>
            </div>

            <div class="grid grid-cols-3 gap-1">
                <p class="col-span-3 text-[9px] text-gray-500 font-bold mb-1 uppercase">Typography</p>
                <button onclick="setF('modern')" class="btn-opt">Modern</button>
                <button onclick="setF('retro')" class="btn-opt">Retro</button>
                <button onclick="setF('mono')" class="btn-opt">Mono</button>
                <button onclick="setF('serif')" class="btn-opt">Serif</button>
                <button onclick="setF('fancy')" class="btn-opt">Fancy</button>
                <button onclick="setF('boldest')" class="btn-opt">Impact</button>
            </div>

            <div class="grid grid-cols-3 gap-1">
                <p class="col-span-3 text-[9px] text-gray-500 font-bold mb-1 uppercase">Vibe Palette</p>
                <button onclick="setV('noir')" class="btn-opt">Noir</button>
                <button onclick="setV('acid')" class="btn-opt">Acid</button>
                <button onclick="setV('vapor')" class="btn-opt">Vapor</button>
                <button onclick="setV('blood')" class="btn-opt">Blood</button>
                <button onclick="setV('deep')" class="btn-opt">Deep</button>
                <button onclick="setV('ghost')" class="btn-opt">Ghost</button>
                <button onclick="setV('lava')" class="btn-opt">Lava</button>
                <button onclick="setV('neon')" class="btn-opt">Neon</button>
                <button onclick="setV('slate')" class="btn-opt">Slate</button>
            </div>
        </section>

        <section class="flex flex-col items-center justify-center bg-[#080808] p-6">
            <div class="card-container">
                <div class="card-inner" id="card">
                    <div class="card-face vibe-noir font-modern pos-center text-4xl font-bold uppercase" id="faceF">TYPE</div>
                    <div class="card-face card-back" id="faceB">
                        <div class="handwritten" id="textB">Write something...</div>
                    </div>
                </div>
            </div>
            
            <button onclick="toggleF()" class="mt-12 px-12 py-4 bg-white text-black rounded-full text-xs font-bold uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-xl">
                FLIP TO REVEAL
            </button>
        </section>
    </main>

    <script>
        const card = document.getElementById('card');
        const faceF = document.getElementById('faceF');
        const textB = document.getElementById('textB');
        let isExporting = false;
        
        let state = { t: "TYPE", m: "Write something...", v: "vibe-noir", f: "font-modern", p: "pos-center", flipped: false };

        document.getElementById('fIn').addEventListener('input', e => { state.t = e.target.value || "TYPE"; render(); });
        document.getElementById('bIn').addEventListener('input', e => { state.m = e.target.value || "Write something..."; render(); });

        function setV(v) { state.v = `vibe-${v}`; render(); }
        function setF(f) { state.f = `font-${f}`; render(); }
        function setPos(p) { state.p = `pos-${p}`; render(); }
        function toggleF() { state.flipped = !state.flipped; card.classList.toggle('flipped'); }

        function render() {
            faceF.innerText = state.t;
            textB.innerText = state.m;
            faceF.className = `card-face ${state.v} ${state.f} ${state.p} text-4xl font-bold uppercase`;
        }

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('v');
            if(data) {
                try {
                    state = JSON.parse(atob(data));
                    document.getElementById('fIn').value = state.t;
                    document.getElementById('bIn').value = state.m;
                    render();
                    setTimeout(() => { if(!state.flipped) toggleF(); }, 1000);
                } catch(e) {}
            }
        };

        function shareLink() {
            const encoded = btoa(JSON.stringify(state));
            const url = `${window.location.origin}${window.location.pathname}?v=${encoded}`;
            navigator.clipboard.writeText(url).then(() => alert("Clickable link copied!"));
        }

        async function exportPNG() {
            const side = state.flipped ? document.getElementById('faceB') : faceF;
            const canvas = await html2canvas(side, { scale: 3, backgroundColor: null });
            const link = document.createElement('a');
            link.download = 'postempo.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
        }

        function cancelExport() {
            isExporting = false;
            document.getElementById('loader').style.display = 'none';
        }

        async function exportGIF() {
            isExporting = true;
            document.getElementById('loader').style.display = 'flex';
            
            // Ultra-fast capture settings
            const canvasF = await html2canvas(faceF, { scale: 1.2, backgroundColor: null });
            if(!isExporting) return;
            const canvasB = await html2canvas(document.getElementById('faceB'), { scale: 1.2, backgroundColor: null });
            if(!isExporting) return;

            gifshot.createGIF({
                images: [canvasF.toDataURL(), canvasB.toDataURL()],
                interval: 0.8,
                gifWidth: 400,
                gifHeight: 260,
                numWorkers: 10,
                sampleInterval: 25 // Drastic speed improvement
            }, function(obj) {
                if(!obj.error && isExporting) {
                    const link = document.createElement('a');
                    link.download = 'postempo_vibe.gif';
                    link.href = obj.image;
                    link.click();
                }
                document.getElementById('loader').style.display = 'none';
            });
        }
    </script>
</body>
</html>